(()=>{class s{static defaults={pickup:{parent:null,disabledClass:"sortable-disabled",addClass:"sortable-dragging",removeClass:""},drop:{parent:null,addClass:"",removeClass:""},callbacks:{pickup:null,drag:null,drop:null,beforeDrop:null},dataAttributes:["id","sort"],dropIndicatorClass:"sortable-drop-indicator",dropIndicator:!0,dragImageClass:"sortable-drag-image",placeholderClass:"sortable-placeholder",debug:!1,allowDuplicateCallbacks:!1};constructor(e,t){if(this.elements=[],this.elementOrSelector=e,this.lastMouseY=0,this.instanceId=this.generateInstanceId(),this.tagNameCopy=null,this.lastDraggedOver=null,this.lastMouseDirection=null,"string"==typeof e)this.elements=Array.from(document.querySelectorAll(e));else if(e instanceof Element)this.elements=[e];else{if(!(e instanceof NodeList||Array.isArray(e)))return void console.error("DomMover: Invalid element or selector provided.");this.elements=Array.from(e)}this.options=Object.assign({},s.defaults,t),this.draggedItem=null,this.draggedItemData=null,this.placeholder=null,this.log=function(...e){this.options.debug&&console.log(`[DomMover ${this.instanceId}]`,...e)},this.init()}generateInstanceId(){return"dm"+Math.random().toString(36).substring(2,9)}init(){this.bindEvents(),this.elements.forEach(e=>{e.setAttribute("draggable","true"),e.classList.add(this.instanceId)})}bindEvents(){var e=this.getParentElement("pickup");e?(e.addEventListener("dragstart",this.handleDragStart.bind(this)),e.addEventListener("dragend",this.handleDragEnd.bind(this)),e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragenter",this.handleDragEnter.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))):this.log("No valid parent for delegation")}handleDragStart(e){var t,s;this.isDraggable(e.target)&&(this.draggedItem=e.target,this.tagNameCopy=this.draggedItem.tagName.toUpperCase(),this.isValidSortableElement(this.tagNameCopy)?(this.draggedItemData=this.getItemData(this.draggedItem),this.addClasses(this.draggedItem,this.options.pickup.addClass),this.removeClasses(this.draggedItem,this.options.pickup.removeClass),t=this.draggedItem.previousElementSibling,s=this.draggedItem.nextElementSibling,"function"==typeof this.options.callbacks.pickup&&this.options.callbacks.pickup(this.draggedItem,this.draggedItemData,t,s),this.createPlaceholder(),this.setCustomDragImage(e)):(console.error(`DomMover: "${this.tagNameCopy}" elements cannot be sorted.`,this.draggedItem),e.preventDefault()))}isValidSortableElement(e){return!["TBODY","THEAD","TFOOT","CAPTION","COLGROUP","COL","HTML","HEAD","BODY"].includes(e)}createPlaceholder(){var e,t;this.placeholder=document.createElement(this.tagNameCopy),"TR"===this.tagNameCopy&&(e=document.createElement("td"),t=this.draggedItem.children.length||1,e.setAttribute("colspan",t.toString()),e.innerHTML=" ",this.placeholder.appendChild(e)),this.placeholder.classList.add(this.options.placeholderClass),this.placeholder.classList.add(this.instanceId),this.options.dropIndicator&&this.placeholder.classList.add(this.options.dropIndicatorClass)}setCustomDragImage(e){let t=this.draggedItem.cloneNode(!0);t.classList.add(this.options.dragImageClass),t.classList.add(this.instanceId),t.style.width=this.draggedItem.offsetWidth+"px",t.style.height=this.draggedItem.offsetHeight+"px",document.body.appendChild(t),e.dataTransfer.setDragImage(t,0,0),requestAnimationFrame(()=>document.body.removeChild(t))}handleDragEnd(e){this.removeClasses(this.draggedItem,this.options.pickup.addClass),this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.draggedItem=null,this.draggedItemData=null,this.placeholder=null,this.tagNameCopy=null,this.lastDraggedOver=null,this.lastMouseDirection=null}handleDragOver(s){s.preventDefault();var i=s.target.closest(this.elementOrSelector+"."+this.instanceId);if(i&&i!==this.draggedItem&&i!==this.placeholder){let e="down",t=(s.clientY<this.lastMouseY&&(e="up"),s.clientY>this.lastMouseY?i.nextElementSibling!==this.placeholder&&i.parentNode.insertBefore(this.placeholder,i.nextSibling):s.clientY<this.lastMouseY&&i.previousElementSibling!==this.placeholder&&i.parentNode.insertBefore(this.placeholder,i),this.lastMouseY=s.clientY,"bottom");this.placeholder.previousElementSibling===i&&(t="top"),!this.options.allowDuplicateCallbacks&&i===this.lastDraggedOver&&e===this.lastMouseDirection||"function"!=typeof this.options.callbacks.drag||this.options.callbacks.drag(s,this.draggedItem,i,t),this.lastDraggedOver=i,this.lastMouseDirection=e}}handleDragEnter(e){e.preventDefault(),this.isDraggable(e.target)&&e.target.closest(this.elementOrSelector+"."+this.instanceId)&&this.draggedItem}handleDrop(t){if(t.preventDefault(),this.draggedItem){var t=this.placeholder.previousElementSibling,s=this.placeholder.nextElementSibling;let e=null;t&&(e=this.getItemData(t)),"function"==typeof this.options.callbacks.beforeDrop&&!1===this.options.callbacks.beforeDrop(this.draggedItem,t,this.draggedItemData,e,s)||(this.placeholder.parentNode.insertBefore(this.draggedItem,this.placeholder),"function"==typeof this.options.callbacks.drop&&this.options.callbacks.drop(this.draggedItem,t,this.draggedItemData,e,s))}}isDraggable(e){let t=e;for(;t;){if(t.classList&&t.classList.contains(this.options.pickup.disabledClass))return!1;if(this.options.pickup.parent&&t.matches(this.options.pickup.parent))break;if(t===document.body)break;t=t.parentNode}return this.isWithinParent(e,"pickup")}isWithinParent(e,t){var t=("pickup"===t?this.options.pickup:this.options.drop).parent;return!t||!(t=document.querySelector(t))||t.contains(e)&&e.classList.contains(this.instanceId)}getParentElement(e){e=("pickup"===e?this.options.pickup:this.options.drop).parent;if(e)return document.querySelector(e);if(0<this.elements.length){let s=this.elements[0].parentNode;for(;s;){let t=!0;for(let e=0;e<this.elements.length;e++)if(!s.contains(this.elements[e])||!this.elements[e].classList.contains(this.instanceId)){t=!1;break}if(t)return s;s=s.parentNode}}return null}getItemData(t){let s={};return this.options.dataAttributes.forEach(e=>{s[e]=t.dataset[e]}),s}addClasses(t,e){e&&e.split(" ").forEach(e=>t.classList.add(e))}removeClasses(t,e){e&&e.split(" ").forEach(e=>t.classList.remove(e))}}"undefined"!=typeof jQuery&&(jQuery.fn.domMover=function(e){return this.each(function(){$.data(this,"plugin_domMover")||$.data(this,"plugin_domMover",new s(this,e))}),this}),window.DomMover=s})();